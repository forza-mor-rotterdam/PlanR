{% load rotterdam_formulier_html %}
{% load vind_in_dict from querystring_tags %}
{% load to_date from date_tags %}
{% load json_encode from json_tags %}

<turbo-frame id="melding_actie_form">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1>
                    <span>Behandelen</span>
                </h1>
                <button
                    type="button"
                    class="btn-close"
                    aria-label="Sluit"
                    data-action="detail#closeModal">
                </button>
            </div>
            <div class="modal-body">
                <section class="section--seperated" data-testid="detailReporter">
                    <div class="container__details">
                        <h2>
                            Behandeling taak
                        </h2>
                        <div class="wrapper">
                            <dl>
                                {% if melding.id %}
                                <div>
                                    <dt>Melding</dt>
                                    <dd>{{ melding.id }}</dd>
                                </div>
                                {% endif %}
                                {% if melding.meta.grafnummer %}
                                <div>
                                    <dt>Graf</dt>
                                    <dd>{{ melding.meta.grafnummer }}</dd>
                                </div>
                                {% endif %}
                                {% if melding.meta.vak %}
                                <div>
                                    <dt>Vak</dt>
                                    <dd>{{ melding.meta.vak }}</dd>
                                </div>
                                {% endif %}
                                {% if melding.onderwerpen %}
                                <div>
                                    <dt>Categorie</dt>
                                    <dd>
                                        {% for onderwerp in melding.onderwerpen %}
                                            {{ onderwerp.response_json.naam }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    </dd>
                                </div>
                                {% endif %}
                                {% if melding.origineel_aangemaakt %}
                                <div>
                                    <dt>Ingediend</dt>
                                    <dd>{{ melding.origineel_aangemaakt|to_date|date:"d-m-Y H:i" }}</dd>
                                </div>
                                {% endif %}


                            </dl>

                        </div>
                    </div>
                </section>
                <section class="section--seperated" data-testid="detailReporter">
                    <div class="container__details">
                        <h2>
                            Controle
                        </h2>
                    <form
                        action="{% url 'melding_afhandelen' melding.uuid %}"
                        method="post"
                        class="form--horizontal"
                        data-controller="meldingbehandelformulier"
                        data-meldingbehandelformulier-standaardafhandelteksten-value="{{standaard_afhandel_teksten|json_encode}}"
                        data-turbo-frame="_top"
                        enctype="multipart/form-data"
                    >

                        {% csrf_token %}

                        {{ form.status|render_rotterdam_formulier }}

                        {{ form.vervolgtaak|render_rotterdam_formulier }}

                        <div class="form-control__with-helptext">
                            {{ form.omschrijving_intern|render_rotterdam_formulier }}
                        </div>

                        {% if melding.meta.terugkoppeling_gewenst == "Ja" %}
                            <div class="form-control__with-helptext">
                                {{ form.omschrijving_extern|render_rotterdam_formulier }}
                            </div>
                        {% endif %}

                        {% if form.bijlagen %}
                            {{ form.bijlagen|render_rotterdam_formulier }}
                        {% endif %}
                        <div class="form-row btn-row">
                            <button
                                type="reset"
                                class="btn btn-tertiary"
                                data-action="incidentHandleForm#cancelHandle"
                            >
                                <span>Annuleren</span>
                            </button>
                            <button
                                type="submit"
                                class="btn btn-action"
                            >
                                <span>Behandelen</span>
                            </button>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</turbo-frame>
