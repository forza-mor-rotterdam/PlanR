{% extends "base.html" %}
{% load vind_in_dict from querystring_tags %}
{% load to_date from date_tags %}

{% block body %}
<turbo-frame id="overvieww" data-turbo-action="advance">
<div class="page__detail">
    <div>
        <a href="javascript:history.back()" data-turbo-action="advance" class="link--back">
            <svg width="25" height="16" viewBox="0 0 25 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.15173 1.73256L7.73753 0.318359L1.44704 6.60885L1.4142 6.576L0 7.9902L1.4115 9.4017L1.37867 9.43453L7.67186 15.7277L9.08606 14.3135L3.7726 9.00006H24.0098V7.00006H3.88423L9.15173 1.73256Z" fill="#404B4F"/>
            </svg>
            Terug
        </a>
    </div>
    <div data-controller="detail">
        <div class="grid-container">
            <div class="grid-item">
                <div class="">
                    <h1>{% if melding.locaties_voor_melding.0.grafnummer %} Grafnummer {{ melding.locaties_voor_melding.0.grafnummer }}, {% endif %}{% if melding.locaties_voor_melding.0.vak %}Vak {{ melding.locaties_voor_melding.0.vak }} {% endif %}</h1>
                    <span>2023-9863</span>
                </div>
            </div>
            <div class="grid-item bottom-left">
                {% if melding.afgesloten_op %}
                <span class="badge badge--green">Afgehandeld</span>
                {% else %}
                <span class="badge badge--lightblue">Openstaand</span>
                {% endif %}
            </div>
        </div>
        <div class="grid-container">
            <div class="grid-item">

                <section class="section--seperated section--imageslider" data-testid="detailPhotoviewer" {% if melding.bijlagen|length < 2 %}style="border: 0;"{% endif %}>
                    <div class="">
                    {% if melding.bijlagen|length > 0 %}
                        <div class="container__imageslider" data-detail-target="imageSliderContainer" data-action="scroll->detail#onScrollSlider">
                            <ul
                                class="list-clean imageslider"
                                style="width: calc(100% * {{ melding.bijlagen|length }})"
                            >
                                {% for bijlage in melding.bijlagen %}
                                <li class="container__image" id="{{ bijlage.bestand }}">
                                    <div class="image" style="background-image: url('{{bijlage.bestand}}')" data-detail-target="selectedImage"></div>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% if melding.bijlagen|length > 1 %}
                            <div class="container__thumbs">
                                <ul data-detail-target="thumbList">
                                    {% for bijlage in melding.bijlagen %}
                                    <li data-action="click->detail#selectImage"
                                        data-detail-image-index-param="{{ forloop.counter }}">
                                        <div class="container__image">
                                            <div class="image" style="background-image:url('{{bijlage.afbeelding_verkleind}}');"></div>
                                        </div>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="background-image"></div>
                    {% endif %}
                    </div>
                </section>

                <section class="section--seperated" data-testid="detailReporter">
                    <div class="container__details">
                        <h2>
                            <svg width="20" height="22" viewBox="0 0 20 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4 4H7V6H4V4Z" fill="#00811F"/>
                                <path d="M7 8H4V10H7V8Z" fill="#00811F"/>
                                <path d="M4 12H7V14H4V12Z" fill="#00811F"/>
                                <path d="M7 16H4V18H7V16Z" fill="#00811F"/>
                                <path d="M8 4H16V6H8V4Z" fill="#00811F"/>
                                <path d="M16 8H8V10H16V8Z" fill="#00811F"/>
                                <path d="M8 12H16V14H8V12Z" fill="#00811F"/>
                                <path d="M16 16H8V18H16V16Z" fill="#00811F"/>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M0 0V22H20V0H0ZM18 2H2V20H18V2Z" fill="#00811F"/>
                            </svg>
                                Verzoek
                            </h2>
                            <div class="display--flex">
                                <ul class="list-clean">
                                    <li>
                                        <h3 class="h5">Ingediend</h3>
                                        <p>
                                            {% if melding.origineel_aangemaakt %}
                                                {{ melding.origineel_aangemaakt|to_date|date:"d-m-Y H:i" }}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </p>
                                    </li>
                                    <li>
                                        <h3 class="h5">Wie heeft het verzoek aangenomen?</h3>
                                        <p>
                                            {% if melding.meta.aannemer %}
                                                {{ melding.meta.aannemer }}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </p>
                                    </li>
                                    <li>
                                        <h3 class="h5">Categorie</h3>
                                        <p>
                                            {% for onderwerp in melding.onderwerpen %}
                                                {% vind_in_dict filter_options.onderwerp onderwerp %}{% if not forloop.last %}, {% endif %}
                                            {% endfor %}
                                        </p>
                                    </li>
                                </ul>
                                <ul class="list-clean">

                                    <li>
                                        <h3 class="h5">Toelichting</h3>
                                        <p>
                                            {% if melding.omschrijving %}
                                                {{ melding.omschrijving }}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </section>
                    <section class="section--seperated" data-testid="detailReporter">
                        <div class="container__details">
                            <h2>
                                <svg width="20" height="26" viewBox="0 0 20 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.6348 3.61315C16.7089 2.48375 15.5439 1.57388 14.2239 0.949138C12.9038 0.324391 11.4616 0.000335693 10.0012 0.000335693C8.54072 0.000335693 7.09849 0.324391 5.77843 0.949138C4.45838 1.57388 3.2934 2.48375 2.36748 3.61315C0.837555 5.46872 0.000854492 7.79875 0.000854492 10.2037C0.000854492 12.6087 0.837555 14.9387 2.36748 16.7943L10.0012 26.0005L17.636 16.7943C19.1651 14.9383 20.0012 12.6083 20.001 10.2035C20.0008 7.79872 19.1643 5.46886 17.6348 3.61315ZM10 13.9991C9.11004 13.9991 8.24004 13.7352 7.50005 13.2407C6.76006 12.7463 6.18331 12.0435 5.84273 11.2213C5.50215 10.399 5.41303 9.49428 5.58666 8.6214C5.76029 7.74852 6.18885 6.94673 6.81817 6.31741C7.44748 5.6881 8.24927 5.25954 9.12215 5.08591C9.99503 4.91228 10.8998 5.00139 11.722 5.34198C12.5443 5.68256 13.247 6.25931 13.7415 6.9993C14.2359 7.73929 14.4998 8.60929 14.4998 9.49927C14.4998 10.6928 14.0258 11.8375 13.1819 12.6815C12.3381 13.5256 11.1936 13.9999 10 14.0002V13.9991Z" fill="#00811F"/>
                                </svg>
                                Locatie
                            </h2>
                            <div class="display--flex">
                                <ul class="list-clean">
                                    <li>
                                        <h3 class="h5">Begraafplaats</h2>
                                        <p>
                                            {% if melding.locaties.0.begraafplaats %}
                                                {% vind_in_dict melding.meta_uitgebreid.begraafplaats.choices melding.locaties.0.begraafplaats %}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </p>
                                    </li>
                                    <li>
                                        <h3 class="h5">Naam overledene</h3>
                                        <p>
                                            {% if melding.meta.naam_overledene %}
                                                {{ melding.meta.naam_overledene }}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </p>
                                    </li>
                                </ul>
                                <ul class="list-clean">
                                    <li>
                                        <h3 class="h5">Grafnummer</h3>
                                        <p>
                                            {% if melding.locaties_voor_melding.0.grafnummer %}
                                                {{ melding.locaties_voor_melding.0.grafnummer }}
                                            {% else %}
                                                n.v.t.
                                            {% endif %}
                                        </p>
                                    </li>
                                    <li>
                                        <h3 class="h5">Vak</h3>
                                        <p>
                                            {% if melding.locaties_voor_melding.0.vak %}
                                                {{ melding.locaties_voor_melding.0.vak }}
                                            {% else %}
                                                n.v.t.
                                            {% endif %}
                                        </p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </section>

                    <section class="section--seperated" data-testid="detailReporter">
                        <div class="container__details">
                            <h2>
                                <svg width="26" height="26" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M10 19.75C15.3848 19.75 19.75 15.3848 19.75 10C19.75 4.61522 15.3848 0.25 10 0.25C4.61522 0.25 0.25 4.61522 0.25 10C0.25 15.3848 4.61522 19.75 10 19.75ZM16.8263 14.6344C17.7248 13.3135 18.25 11.7181 18.25 10C18.25 5.44365 14.5563 1.75 10 1.75C5.44365 1.75 1.75 5.44365 1.75 10C1.75 11.7442 2.29129 13.362 3.21505 14.6946C3.20119 14.6746 3.18741 14.6545 3.17373 14.6344C4.21773 13.4205 5.57996 12.4882 7.13098 11.967C6.13466 11.1415 5.5 9.89489 5.5 8.5C5.5 6.01472 7.51472 4 10 4C12.4853 4 14.5 6.01472 14.5 8.5C14.5 9.8949 13.8653 11.1416 12.869 11.967C14.42 12.4883 15.7823 13.4206 16.8263 14.6344ZM15.8549 15.8123C14.4804 14.0978 12.3684 13 9.99998 13C7.63159 13 5.5196 14.0978 4.14511 15.8123C5.63972 17.3178 7.71099 18.25 10 18.25C12.289 18.25 14.3603 17.3178 15.8549 15.8123ZM10 5.5C8.34315 5.5 7 6.84315 7 8.5C7 10.1569 8.34315 11.5 10 11.5C11.6569 11.5 13 10.1569 13 8.5C13 6.84315 11.6569 5.5 10 5.5Z" fill="#00811F"/>
                                </svg>
                                Melder
                            </h2>
                            <div class="display--flex">
                                <ul class="list-clean incident-meta-list">
                                    {% if melding.meta.naam_melder %}
                                    <li>
                                        <p class="text--person">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M10 19.75C15.3848 19.75 19.75 15.3848 19.75 10C19.75 4.61522 15.3848 0.25 10 0.25C4.61522 0.25 0.25 4.61522 0.25 10C0.25 15.3848 4.61522 19.75 10 19.75ZM16.8263 14.6344C17.7248 13.3135 18.25 11.7181 18.25 10C18.25 5.44365 14.5563 1.75 10 1.75C5.44365 1.75 1.75 5.44365 1.75 10C1.75 11.7442 2.29129 13.362 3.21505 14.6946C3.20119 14.6746 3.18741 14.6545 3.17373 14.6344C4.21773 13.4205 5.57996 12.4882 7.13098 11.967C6.13466 11.1415 5.5 9.89489 5.5 8.5C5.5 6.01472 7.51472 4 10 4C12.4853 4 14.5 6.01472 14.5 8.5C14.5 9.8949 13.8653 11.1416 12.869 11.967C14.42 12.4883 15.7823 13.4206 16.8263 14.6344ZM15.8549 15.8123C14.4804 14.0978 12.3684 13 9.99998 13C7.63159 13 5.5196 14.0978 4.14511 15.8123C5.63972 17.3178 7.71099 18.25 10 18.25C12.289 18.25 14.3603 17.3178 15.8549 15.8123ZM10 5.5C8.34315 5.5 7 6.84315 7 8.5C7 10.1569 8.34315 11.5 10 11.5C11.6569 11.5 13 10.1569 13 8.5C13 6.84315 11.6569 5.5 10 5.5Z" fill="#00811F"/>
                                            </svg>
                                            {{ melding.meta.naam_melder }}
                                        </p>
                                    </li>
                                    {% endif %}
                                    {% if melding.meta.telefoon_melder %}
                                    <li>
                                        <a href="tel:{{ melding.meta.telefoon_melder }}" class="link--phone">
                                            <svg width="22" height="22" viewBox="0 0 14 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M1.43934 0.5H12.5607L13.75 1.68934V20.3107L12.5607 21.5H1.43934L0.25 20.3107V1.68934L1.43934 0.5ZM2.06066 2L1.75 2.31066V19.6893L2.06066 20H11.9393L12.25 19.6893V2.31066L11.9393 2H10L9.25 3.5H4.75L4 2H2.06066ZM7 16.25C6.17157 16.25 5.5 16.9216 5.5 17.75C5.5 18.5784 6.17157 19.25 7 19.25C7.82843 19.25 8.5 18.5784 8.5 17.75C8.5 16.9216 7.82843 16.25 7 16.25Z" fill="#00811F"/>
                                            </svg>
                                            {{ melding.meta.telefoon_melder }}
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if melding.meta.email_melder %}
                                    <li>
                                        <a href="mailto:{{  melding.meta.email_melder }}" class="link--email">
                                            <svg width="22" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" clip-rule="evenodd" d="M19.75 0.5H0.25V15.5H19.75V0.5ZM1.75 4.5V2H18.25V4.5L10 7.9375L1.75 4.5ZM1.75 6.125V14H18.25V6.125L10 9.5625L1.75 6.125Z" fill="#00811F"/>
                                            </svg>
                                            {{  melding.meta.email_melder }}
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                                <ul class="list-clean">
                                    <div>
                                        <h3 class="h5">Is deze persoon de rechthebbende?</h3>
                                        <p>
                                            {{ melding.meta.rechthebbende }}
                                        </p>
                                    </div>
                                    <div>
                                        <h3 class="h5">Is terugkoppeling gewenst?</h3>
                                        <p>
                                            {{ melding.meta.terugkoppeling_gewenst }}
                                        </p>
                                    </div>
                                </ul>
                            </div>

                        </div>
                    </section>
                    <section class="section--seperated print-only">
                        <div class="container__details">
                            <h2>Opmerkingen</h2>
                        </div>
                    </section>
                    {% if melding.bijlagen|length > 0 %}
                    <section class="section--seperated section--imagelist print-only">
                        <div class="container__details">
                            <h2>Afbeeldingen</h2>
                            <ul class="list-clean">
                                {% for bijlage in melding.bijlagen %}
                                <li class="container__image">
                                    <img src="{{bijlage.bestand}}" alt=""/>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </section>
                    {% endif %}
                </div>
                <div class="grid-item aside">

                    <div class="container__actions">
                        {% if not melding.afgesloten_op %}
                        <p>
                            <button type="button" class="btn btn-action" data-action="detail#openModal"><span>Behandelen</span></button>
                        </p>
                        {% endif %}
                        <p>
                            <a href="" role="button" class="btn btn-icon btn-textlink">
                                <svg width="16" height="16" viewBox="0 0 44 44" fill="none" xmlns="http://www.w3.org/2000/svg" title="">
                                    <path d="M37.0008 9.99962V-0.000244141H7.00118V9.99962H0.00195312V34.0002H7.00118V44H38.001V34.0002H44V9.99962H37.0008ZM35.0003 40.9994H9.99956V23.0001H35.0003V40.9994ZM9.99956 3.00039H34.0001V9.99962H9.99956V3.00039Z" fill="#00811F"/>
                                    <path d="M31.9997 36.0006H13.0002V39.0012H31.9997V36.0006Z" fill="#00811F"/>
                                    <path d="M31.9997 30.0016H13.0002V33.0022H31.9997V30.0016Z" fill="#00811F"/>
                                </svg>
                                Download pdf
                            </a>
                        </p>
                        <p>
                            <a href="" role="button" class="btn btn-icon btn-textlink">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M13.875 1.425H4.125L3.13577 5.25H5.25V3.075H12.75V5.25L14.8642 5.25L13.875 1.425ZM16.3816 5.25L15.375 1.425L15 0H14.25H3.75H3L2.625 1.425L2.625 1.425L1.61842 5.25H0.75V6.75H1.62805L3 18H3.75H14.25H15L16.3719 6.75H17.25V5.25H16.3816ZM13.6594 16.5L14.8781 6.75H3.12188L4.34063 16.5H13.6594Z" fill="#00811F"/>
                                </svg>

                                Verwijderen
                            </a>
                        </p>


                    </div>

                    <section class="section--seperated" data-testid="detailReporter">
                        <div class="container__details">
                            <h2>
                                <svg width="21" height="22" viewBox="0 0 21 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M19.0009 11C19.0009 15.9706 14.9715 20 10.0009 20C6.96008 20 4.27145 18.4919 2.64218 16.1829L0.953125 17.2577C2.93876 20.1233 6.25068 22 10.0009 22C16.0761 22 21.0009 17.0751 21.0009 11C21.0009 4.92487 16.0761 0 10.0009 0C6.96339 0 4.21339 1.23121 2.22279 3.22181L1.00098 2V6H5.00098L3.637 4.63602C5.26568 3.00735 7.51567 2 10.0009 2C14.9715 2 19.0009 6.02944 19.0009 11Z" fill="#00811F"/>
                                    <path d="M9.00098 5H11.001V11.8573L15.1973 14.28L14.1973 16.0121L9.00098 13V5Z" fill="#00811F"/>
                                </svg>

                                Tijdlijn
                            </h2>
                            <div class="display--flex">
                                <ul class="list__mutations">
                                {% for melding_gebeurtenis in melding.melding_gebeurtenissen %}
                                    <li data-controller="datetime" data-datetime-date-object-value="{{ melding_gebeurtenis.aangemaakt_op }}">
                                        <details>
                                            <summary>
                                                {% if melding_gebeurtenis.aangemaakt_op %}
                                                    <strong>{{ melding_gebeurtenis.aangemaakt_op|to_date|date:"d-m-Y" }} <span data-datetime-target="timeHoursMinutes"></span></strong><br>
                                                {% endif %}
                                                {% if melding_gebeurtenis.gebeurtenis_type %}
                                                    <strong>{{ melding_gebeurtenis.gebeurtenis_type }}</strong>
                                                {% endif %}
                                            </summary>
                                            <dl>
                                                {% if melding_gebeurtenis.omschrijving_extern %}
                                                    <dt class="h5">Bericht voor de melder</dt>
                                                    <dd>{{ melding_gebeurtenis.omschrijving_extern }}</dd>
                                                {% endif %}

                                                {% if melding_gebeurtenis.omschrijving_intern %}
                                                    <dt class="h5">Interne opmerking</dt>
                                                    <dd>{{ melding_gebeurtenis.omschrijving_intern }}</dd>
                                                {% endif %}
                                            </dl>
                                        </details>
                                    </li>
                                {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </section>

                </div>
            </div>
        </div>
    </div>

    <div class="modal" data-controller="detail">
        {% comment %} <div class="modal"> {% endcomment %}
            <div class="modal-backdrop modal-exit" id="modal-backdrop"data-action="click->detail#closeModal"></div>
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                    <h1>
                        <span>Behandelen</span>
                    </h1>
                    <button
                        type="button"
                        class="btn-close"
                        aria-label="Sluit"
                        data-action="detail#closeModal">
                    </button>
                    </div>
                    <div class="modal-body">
                    <turbo-frame id="melding_afhandelen" src="{% url 'melding_afhandelen' melding.id %}">

                    </turbo-frame>
                    {% comment %} <turbo-frame
                        id="behandel_modal"
                        data-src=""
                        src=""
                        laoding="lazy"
                    >
                    {% if form %}
                    <form action="" method="post" data-testid="handleIncidentForm" class="form--incident-handle" novalidate>
                        {% csrf_token %}
                        <fieldset>
                        {{ form.handle_choice.label_tag }}
                        {% endif %}
                        {{ form.handle_choice }}
                        {{ form.handle_choice.errors }}
                        {% if not form.handle_choice.is_hidden %}
                        </fieldset>
                        {% endif %}

                        <fieldset>
                            <div class="form-row">
                                <div class="display-flex">
                                    {{ form.external_text.label_tag }}
                                    <button class="btn-textlink" type="button" data-action="incidentHandleForm#clearExternalMessage">Wissen</button>

                                </div>
                                {{ form.external_text }}
                                {{ form.external_text.errors }}
                                <button class="btn-textlink" type="button" data-action="incidentHandleForm#defaultExternalMessage">Gebruik de standaard afhandeltekst</button>
                            </div>
                        </fieldset>
                        <fieldset>
                            <div>
                                {{ form.internal_text.label_tag }}
                                {{ form.internal_text }}
                                {{ form.internal_text.errors }}
                            </div>
                        </fieldset>
                        <div class="form-row">
                            <button
                                type="submit"
                                class="btn btn-action"
                            >
                                <span>Afhandelen</span>
                            </button>
                            <button
                                type="reset"
                                class="btn btn-tertiary"
                                data-action="incidentHandleForm#cancelHandle"
                            >
                                <span>Annuleren</span>
                            </button>
                        </div>
                    </form>
                    </form>
                    </turbo-frame> {% endcomment %}
                </div>
            </div>
        </div>
    </div>
</turbo-frame>
{% endblock body %}
